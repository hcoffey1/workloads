# MERCI baseline sequential hot region

- The baseline loads the test set in [eval_baseline.cc](MERCI/4_performance_evaluation/src/eval_baseline.cc#L62-L99) and builds two large contiguous buffers: `embedding_table` and `qres`, both stored as `vector<array<float, EMBEDDING_DIM>>` in [evaluator.h](MERCI/4_performance_evaluation/src/evaluator.h#L5-L43).
- Query ingestion replicates each line by its weight (first integer) in [utils.h](MERCI/4_performance_evaluation/src/utils.h#L117-L157), so the number of stored queries (`qcount`) is the sum of weights, not the line count. For the amazon_All test set I computed `total_q = 22,348,203` and `total_feature_occurrences = 1,538,955,983` (average length ≈ 68.86) via `awk`.
- `qres` is resized to `qcount` in [evaluator.h](MERCI/4_performance_evaluation/src/evaluator.h#L31-L44) and initialized linearly. With `EMBEDDING_DIM = 64`, each entry is 256 bytes, so `qres` alone is about $22{,}348{,}203 \times 256 \approx 5.33\,\text{GiB}$ of contiguous memory. This matches the observed 5–6 GiB hot region.
- The embedding table is also contiguous: `num_features` comes from the metadata line in the test file (amazon_All reports 7,952,569). `embedding_table.resize(num_features)` in [evaluator.h](MERCI/4_performance_evaluation/src/evaluator.h#L22-L29) yields about $7{,}952{,}569 \times 256 \approx 1.90\,\text{GiB}$.
- During execution, each worker writes sequentially into `qres` (`qres[i + myqbase][l]` in [evaluator.h](MERCI/4_performance_evaluation/src/evaluator.h#L64-L75)), so the contiguous 5.3 GiB buffer is touched densely and repeatedly, creating the large sequential access range likely observed near `0x7ffd00000000-0x7ffeff000000`.
- To confirm the mapping at runtime, print the base and end addresses before calling `eval` (e.g., `printf("qres base=%p end=%p bytes=%zu\n", qres.data(), qres.data()+qres.size(), qres.size()*sizeof(qres[0]));`) or sample `/proc/<pid>/maps`/`pmap` while the baseline runs. The printed span should align with the suspected address range and the computed ~5.3 GiB size.
